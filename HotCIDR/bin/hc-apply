#!/usr/bin/python
import argparse
import datetime
import os
import sys
from hotcidr.apply import *
 
if __name__ == "__main__":

   current = datetime.datetime.now()
   currStr = str(current).rstrip('datetime.datetime')
   finalStr = str(currStr[:19])

   print '\n\n*********************** Beginning hc-apply run at %s**********************\n' % finalStr 

   #clean up current directory
   if os.path.isdir('AWS_out') or os.path.isdir('hotcidr'):
      print 'Cleaning up current directory'
      deleteLocalRepos()

   #parse command line arguments
   parser = argparse.ArgumentParser(description="Keep AWS consistent with corresponding Git Repository")
   parser.add_argument('git_repo', help='Git Repository AWS is based on\n')
   parser.add_argument('aws_region' , help= 'AWS region name\n')
   parser.add_argument('aws_access_key_id', help='AWS Access Key Id\n')
   parser.add_argument('aws_secret_access_key', help='AWS Secret Access Key\n')
   args = vars(parser.parse_args())

   args['git_repo'], is_clone_url = gitlib.get_valid_repo(args['git_repo'])
   if not args['git_repo']:
       sys.exit(1)

   main(args['git_repo'], is_clone_url, str(args['aws_region']), str(args['aws_access_key_id']), str(args['aws_secret_access_key']))

